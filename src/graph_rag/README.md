# Graph RAG

## Goal

The goal is to use BAML to run Graph RAG. We will use K첫zu as the graph database. In this demo,
the term "Graph RAG" is used to mean that we will use a graph database to store the movie data,
run a Text-to-Cypher query pipeline in BAML to generate a Cypher query via an LLM that's aware
of the graph schema. We will then use this Cypher query to query the K첫zu database, retrieve
the results, and pass that as context to an LLM to answer the question.

## Setup

To sync the dependencies, run the following command:
```bash
# Assumes that the uv package manager is installed
# https://github.com/astral-sh/uv
uv sync
```

If you want to add more dependencies, you can do so as follows:
```bash
uv add <dependency>
```

## Run the workflow

To ingest the graph data (nodes, edges and their associated properties) into K첫zu, run `create_graph.py`.
```bash
uv run create_graph.py
```

To execute the BAML workflow, run the code in `run_baml.py`.
```bash
uv run run_baml.py
```

This will output the following. The Cypher query is generated by the LLM and executed against the K첫zu database,
which is then used by the LLM to answer the question.

```console
MATCH (a:Actor)-[:PLAYED]->(c:Character)-[:PLAYED_ROLE_IN]->(m:Movie) WHERE LOWER(c.name) = 'murphy cooper' AND LOWER(m.title) = 'interstellar' RETURN a.name
question='Which actor played the character Murphy Cooper in the movie Interstellar?' answer="['Jessica Chastain']"
question='Which actor played the character Murphy Cooper in the movie Interstellar?' answer='Jessica Chastain played the character Murphy Cooper in the movie Interstellar.'
```